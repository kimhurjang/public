<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragment/layout}">

<body>

<th:block layout:fragment="css">
  <link rel="stylesheet" href="/css/find.css" />
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet" />
</th:block>

<section layout:fragment="content" id="container" class="sub login-page">
  <div class="login-container">
    <div class="login_box">

      <!-- 제목 영역 -->
      <h2 id="form-title" th:text="${pwError} == null ? '아이디 찾기' : '비밀번호 찾기'">아이디 찾기</h2>

      <!-- 아이디 찾기 폼 -->
      <form id="find-id-form" method="POST" action="/api/member/find-id"
            th:style="${pwError} != null ? 'display:none;' : 'display:block;'">
        <div class="input_group">
          <label for="name_input1">이름</label>
          <input type="text" id="name_input1" name="name" required placeholder="이름을 입력하세요" />
        </div>

        <div class="input_group">
          <label for="mobile_input1">전화번호</label><br />
          <input type="text" id="mobile_input1" name="mobile1" maxlength="3" required placeholder="010" style="width: 70px;" /> -
          <input type="text" id="mobile_input2" name="mobile2" maxlength="4" required placeholder="1234" style="width: 80px;" /> -
          <input type="text" id="mobile_input3" name="mobile3" maxlength="4" required placeholder="5678" style="width: 80px;" />
        </div>

        <!-- 아이디 찾기 메시지 표시 -->
        <p th:if="${message}" th:text="${message}" style="color: green; margin-top: 10px;"></p>
        <p th:if="${error}" th:text="${error}" style="color: red; margin-top: 10px;"></p>

        <!-- 아이디 찾기 폼용 링크 (전화번호 입력 밑) -->
        <div class="links" style="margin-bottom: 20px;">
          <a href="#" class="link-find-id" th:style="${pwError} == null ? 'font-weight: bold;' : 'font-weight: normal;'">아이디 찾기</a> |
          <a href="#" class="link-find-pw" th:style="${pwError} != null ? 'font-weight: bold;' : 'font-weight: normal;'">비밀번호 찾기</a> |
          <a href="/api/member/join">회원가입</a>
        </div>

        <div style="display: flex; gap: 10px; align-items: center; margin-top: 10px;">
          <!-- 성공 시 로그인 버튼만 -->
          <button class="login_button" type="button" onclick="location.href='/api/member/login'" th:if="${message != null}">로그인</button>

          <!-- 실패 시 아이디 찾기 버튼과 회원가입 버튼 -->
          <th:block th:if="${message == null}">
            <button type="submit" class="login_button">아이디 찾기</button>
          </th:block>
        </div>
      </form>

      <!-- 비밀번호 찾기 폼 -->
      <form id="find-pw-form" action="/api/member/find-password" method="post"
            th:style="${pwError} != null ? 'display:block;' : 'display:none;'">
        <div class="input_group">
          <label for="id_input">아이디</label>
          <input type="text" id="id_input" name="id" placeholder="아이디" required />
        </div>

        <div class="input_group">
          <label for="name_input2">이름</label>
          <input type="text" id="name_input2" name="name" placeholder="이름" required />
        </div>

        <!-- 비밀번호 찾기 폼용 링크 (입력칸 바로 밑) -->
        <div class="links" style="margin-bottom: 20px;">
          <a href="#" class="link-find-id" th:style="${pwError} == null ? 'font-weight: bold;' : 'font-weight: normal;'">아이디 찾기</a> |
          <a href="#" class="link-find-pw" th:style="${pwError} != null ? 'font-weight: bold;' : 'font-weight: normal;'">비밀번호 찾기</a> |
          <a href="/api/member/join">회원가입</a>
        </div>

        <!-- 비밀번호 찾기 오류 메시지 -->
        <p th:if="${pwError}" th:text="${pwError}" style="color: red; margin-top: 10px;"></p>

        <button type="submit" class="login_button">비밀번호 찾기</button>
      </form>

    </div>
  </div>
</section>

<th:block layout:fragment="js">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // 링크 요소들 - 각각 두 폼 내에 있으므로 querySelectorAll으로 각각 선택
      const linkFindIdList = document.querySelectorAll('.link-find-id');
      const linkFindPwList = document.querySelectorAll('.link-find-pw');
      const formTitle = document.getElementById('form-title');
      const findIdForm = document.getElementById('find-id-form');
      const findPwForm = document.getElementById('find-pw-form');

      function activateLink(selected) {
        if(selected === 'id') {
          formTitle.textContent = '아이디 찾기';
          findIdForm.style.display = 'block';
          findPwForm.style.display = 'none';
          linkFindIdList.forEach(el => el.style.fontWeight = 'bold');
          linkFindPwList.forEach(el => el.style.fontWeight = 'normal');
        } else {
          formTitle.textContent = '비밀번호 찾기';
          findIdForm.style.display = 'none';
          findPwForm.style.display = 'block';
          linkFindIdList.forEach(el => el.style.fontWeight = 'normal');
          linkFindPwList.forEach(el => el.style.fontWeight = 'bold');
        }
      }

      // 이벤트 리스너 연결
      linkFindIdList.forEach(el => el.addEventListener('click', (e) => {
        e.preventDefault();
        activateLink('id');
      }));

      linkFindPwList.forEach(el => el.addEventListener('click', (e) => {
        e.preventDefault();
        activateLink('pw');
      }));
    });
  </script>
</th:block>

</body>
</html>

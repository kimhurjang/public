<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{fragment/layout}">
<body>
<th:block layout:fragment="css"><link rel="stylesheet" href="/css/common.css"></th:block><!--넣고자 하는 css 이름 변경-->
<section layout:fragment="content" id="container" class="sub pagename pageSubname"> <!--안내페이지는 sub 붙여야함(크키 및 쉐도우가 다름)-->
    <h1>회원 가입</h1>
    <p class="section_title_sub"><span class="required">*</span> 필수 입력 항목</p>

    <form id="joinForm" action="/api/member/join" method="post">

        <input type="hidden" name="create_at" value="create_at">
        <input type="hidden" name="idx" value="idx">
        <input type="hidden" name="grade" value="1">
        <input type="hidden" name="status" value="정상">

        <!-- 아이디 -->
        <div class="form_group">
            <label for="userid">아이디 <span class="required">*</span></label>
            <input type="text" id="userid" name="userid" required>
            <button type="button" id="checkIdBtn">중복 확인</button>
            <span id="idCheckResult"></span>
        </div>

        <!-- 비밀번호 -->
        <div class="form_group">
            <label for="password">비밀번호 <span class="required">*</span></label>
            <input type="password" id="password" name="pwd" required>
        </div>

        <!-- 이름 -->
        <div class="form_group">
            <label for="name">이름 <span class="required">*</span></label>
            <input type="text" id="name" name="name" required>
        </div>

        <!-- 닉네임 -->
        <div class="form_group">
            <label for="nickname">닉네임 <span class="required">*</span></label>
            <input type="text" id="nickname" name="nickname" required>
        </div>

        <!-- 연락처 (선택 입력) -->
        <div class="form_group mobile">
            <label for="mobile">연락처 <span class="required">*</span></label>
            <input type="text" name="mobile1" maxlength="3" placeholder="010" required>
            <input type="text" name="mobile2" maxlength="4" required>
            <input type="text" name="mobile3" maxlength="4" required>
        </div>

        <!-- 이메일 (선택 입력) -->
        <div class="form_group">
            <label for="email">이메일</label>
            <input type="text" id="email" name="email">
        </div>

        <!-- 생년월일 (선택 입력) -->
        <div class="form_group">
            <label for="birthdate">생년월일</label>
            <input type="date" id="birthdate" name="birthdate">
        </div>

        <!-- 통신사 -->
        <div class="form_group">
            <label>통신사</label>
            <div class="hall">
                <label><input type="radio" name="telecom" value="skt" required> SKT</label>
                <label><input type="radio" name="telecom" value="kt" required> KT</label>
                <label><input type="radio" name="telecom" value="lg" required> LG</label>
            </div>
        </div>

        <!-- 제출 버튼 -->
        <div class="btn_group mt20">
            <button type="submit" class="color1">제출</button>
        </div>
    </form>
    <script>
        // 아이디 중복 확인
        document.getElementById("checkIdBtn").addEventListener("click", function() {
            var userid = document.getElementById("userid").value;

            if (userid === "") {
                alert("아이디를 입력해주세요.");
                return;
            }

            var checkBtn = document.getElementById("checkIdBtn");
            checkBtn.disabled = true;  // 중복 확인 버튼 비활성화

            fetch("/api/member/idcheck?userid=" + encodeURIComponent(userid))
                .then(response => response.text())
                .then(result => {
                    if (result === "Y") {
                        document.getElementById("idCheckResult").textContent = "아이디가 중복됩니다.";
                        document.getElementById("idCheckResult").style.color = "red";
                    } else {
                        document.getElementById("idCheckResult").textContent = "사용 가능한 아이디입니다.";
                        document.getElementById("idCheckResult").style.color = "green";
                    }
                    checkBtn.disabled = false;
                })
                .catch(error => {
                    console.error("Error:", error);
                    checkBtn.disabled = false;
                });
        });

        // 폼 제출 전에 유효성 검사
        document.getElementById("joinForm").addEventListener("submit", function(event) {
            var userid = document.getElementById("userid").value;
            var idCheckResult = document.getElementById("idCheckResult").textContent;

            // 아이디 중복 체크
            if (idCheckResult === "아이디가 중복됩니다.") {
                event.preventDefault();
                alert("아이디가 중복됩니다. 다른 아이디를 사용해주세요.");
                return;
            } else if (idCheckResult === "") {
                event.preventDefault();
                alert("아이디 중복 확인을 해주세요.");
                return;
            }

            // 필수 항목 검사 (input[required] + checked radio)
            var requiredInputs = document.querySelectorAll("input[required]");
            for (var i = 0; i < requiredInputs.length; i++) {
                if (requiredInputs[i].type === "radio") {
                    // radio 그룹 중 하나라도 선택되었는지 확인
                    var name = requiredInputs[i].name;
                    var checked = document.querySelector('input[name="' + name + '"]:checked');
                    if (!checked) {
                        event.preventDefault();
                        alert("통신사를 선택해주세요.");
                        return;
                    }
                } else {
                    if (requiredInputs[i].value.trim() === "") {
                        event.preventDefault();
                        alert(requiredInputs[i].previousElementSibling.textContent.replace('*', '').trim() + "을(를) 입력해주세요.");
                        requiredInputs[i].focus();
                        return;
                    }
                }
            }
        });
    </script>
</section><!--E container-->
</body>
</html>

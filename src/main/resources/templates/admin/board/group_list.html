<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/fragment/layout}">
<th:block layout:fragment="css">
    <style>
        table {display : table;}
        #detailBtn div {display: flex; justify-content: space-around;box-shadow: 1px lightgray;}
        #detailBtn a, #detailBtn span {width: 40%; display : table-cell;}
        #detailBtn span {border-left: 1px solid lightgray;}
        .form_group input[type="text"]{ min-width: 260px; flex: 0;}
        #categorySelect {min-width: 150px; flex: 0;}
    </style>
</th:block>
<body>
<!--<th:block layout:fragment="css"><link rel="stylesheet" href="/css/common.css"></th:block>넣고자 하는 css 이름 변경-->
<section layout:fragment="content" id="container" class="sub pagename pageSubname"> <!--안내페이지는 sub 붙여야함(크키 및 쉐도우가 다름)-->
    <h1>게시판 그룹별 관리</h1>
    <div id="content" class="content">
        <form name="selectAdminBoard" method="post" action="/admin/board/group_list_select">
            <input type="hidden" name="page" value="1">
            <input type="hidden" name="delCheck" id="delCheckHidden" />
            <div>
                <div class="form_group mb20">
                    <select id="categorySelect" name="group_idx" style="width: 50%;">
                        <option  value="" disabled th:selected="${group_idx == null}">카테고리</option>
                        <option value="1" th:selected="${group_idx == 1}">공지</option>
                        <option value="2" th:selected="${group_idx == 2}">커뮤니티</option>
                        <option value="3" th:selected="${group_idx == 3}">이벤트</option>
                        <option value="4" th:selected="${group_idx == 4}">갤러리</option>
                        <option value="5" th:selected="${group_idx == 5}">자주 묻는 질문</option>
                        <option value="6" th:selected="${group_idx == 6}">1 대 1 질문</option>
                    </select>
                    <input type="hidden" name="group_idx_hidden" id="groupIdxHidden" />
                    <button type="submit" name="action" value="search" class="small">조회하기</button>
                    <button type="submit" name="action" value="delete" class="small" onclick="return confirm('정말 삭제하시겠습니까? 복구할 수 없습니다.');">선택 삭제</button>
                </div>
                <div class="form_group mb20">
                    <input type="text" name="keyword" placeholder="제목을 입력해주세요." th:value="${keyword}"> <button type="submit" name="action" value="search" class="small">검색</button>
                </div>
            </div>
        <table>
            <thead>
                <tr>
                    <th><input type="checkbox" id="allCheck" name="delCheck" th:value="${delCheck}"></th>
                    <th>카테고리</th>
                    <th style="width: 40%;">제목</th>
                    <th>등록 일자</th>
                    <th colspan="3" style="width:30%;">설정</th>
                </tr>
            </thead>
            <tbody id="adminBoardList">
                <tr th:if="${paging == null}">
                    <td colspan="7" style="color: #999;">카테고리 선택 후 조회하기</td>
                </tr>
                <tr th:if="${paging?.isEmpty()}">
                    <td colspan="7">조회된 게시글이 없습니다.</td>
                </tr>
                <tr th:each="board : ${paging}">
                    <td><input type="checkbox" name="delCheck" th:value="${board.idx}"></td>
                    <td th:text="${category}"></td>
                    <td><a href="#"><span th:text="${board.title}"></span></a></td>
                    <td th:text="${#dates.format(board.createdAt, 'yy.MM.dd HH:mm')}"></td>
                    <td>
                        <a th:href="@{/admin/board/delete(id=${board.idx},groupIdx=${groupIdx},page=${page})}" onclick="return confirm('정말 삭제하시겠습니까? 복구할 수 없습니다.');">
                            <button type="button" class="small">삭제</button>
                        </a>
                    </td>
                    <td>
                        <a th:if="${groupIdx >= 1 and groupIdx <= 4}"
                           th:href="@{/board/modify(group_idx=${groupIdx}, board_type=${boardType}, idx=${board.idx}, commentsIdx=0)}">
                            <button type="button" class="small">수정</button>
                        </a>
                        <a th:if="${groupIdx == 5 or groupIdx == 6}"
                           th:href="@{/admin/board/modify(id=${board.idx}, groupIdx=${groupIdx}, page=${page})}">
                            <button type="button" class="small">수정</button>
                        </a>
                    </td>
                    <td id="detailBtn">
                        <div>
                            <a th:if="${groupIdx == 1}"
                               th:href="@{/board/notice_view(group_idx=${groupIdx}, idx=${board.idx}, member=${board.member != null ? board.member.idx : 0}, board_type=${boardType})}">
                                <button type="button" class="small">상세보기</button>
                            </a>
                            <a th:if="${groupIdx == 2}"
                               th:href="@{/board/cmct_view(group_idx=${groupIdx}, idx=${board.idx}, member=${board.member != null ? board.member.idx : 0}, board_type=${boardType})}">
                                <button type="button" class="small">상세보기</button>
                            </a>
                            <a th:if="${groupIdx == 3}"
                               th:href="@{/board/event_view(group_idx=${groupIdx}, idx=${board.idx}, member=${board.member != null ? board.member.idx : 0}, board_type=${boardType})}">
                                <button type="button" class="small">상세보기</button>
                            </a>
                            <a th:if="${groupIdx == 4}"
                               th:href="@{/board/gallery_view(group_idx=${groupIdx}, idx=${board.idx}, member=${board.member != null ? board.member.idx : 0}, board_type=${boardType})}">
                                <button type="button" class="small">상세보기</button>
                            </a>
                            <a th:if="${groupIdx == 5 or groupIdx == 6}" th:href="@{/admin/board/group_view(idx=${board.idx},groupIdx=${groupIdx},page=${page})}"><button type="button" class="small">상세보기</button></a>
                            <span th:if="${board.request == 0 and groupIdx == 6}">대기중</span>
                            <span th:if="${board.request == 1 and groupIdx == 6}" class="xi-check"></span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        </form>
        <div th:if="${paging != null and !paging.isEmpty()}">
            <div th:replace="~{fragment/paging_admin_board :: paging_admin_board(
                    page=${page},
                    pagination=${pagination},
                    link=${link},
                    groupIdx=${groupIdx},
                    boardType=${boardType}
                )}">
            </div>
        </div>
    </div><!--E content-->
</section><!--E container-->
</body>
</html>
<script>

      document.getElementById('allCheck').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('input[name="delCheck"]');
        checkboxes.forEach(cb => cb.checked = this.checked);
      });

      const form = document.forms['selectAdminBoard'];
      const select = document.getElementById('categorySelect');
      const hiddenInput = document.getElementById('groupIdxHidden');

      form.addEventListener('submit', function(event) {
        // 선택된 카테고리 값을 hidden에 넣기
        hiddenInput.value = select.value;
      });
      document.querySelector('button[name="action"][value="search"]').addEventListener('click', function(event) {
        const select = document.getElementById('categorySelect');
        if (!select.value) {
          event.preventDefault(); // 폼 제출 막기
          alert('카테고리를 선택해 주세요.');
          select.focus();
          return false;
        }

      });

</script>



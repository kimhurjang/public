<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/fragment/layout}"
      th:inline="javascript">
<body>

<th:block layout:fragment="css">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <style>
        .fc .fc-button-primary {background:#fff;}
        .fc .fc-button-primary:hover {background:#ccc;}
        .fc .fc-today-button {background:#2C3E50;}
        .fc .fc-button-primary:focus {box-shadow: none;}
        .fc-toolbar-chunk:nth-child(2) {margin-left:-150px;}
        .fc-h-event {border:1px solid #ccc; background:transparent; cursor:pointer;}
        .fc-h-event * {font-size:13px;}
    </style>
</th:block>

<section layout:fragment="content" id="container" class="schedule list">
    <h2>일정관리</h2>
    <div id="content" class="content">
        <a href="/admin/schedule/form" class="btn color1 small">+ 일정 등록</a>
        <div id="calendar" th:attr="data-schedule=${list}"></div>

        <script>
            const raw = document.getElementById('calendar').dataset.schedule || '[]';

            try {
              const scheduleList = JSON.parse(raw);
              console.log("✅ 일정목록:", scheduleList);

              const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
                initialView: 'dayGridMonth',
                locale: 'ko',
                height: 800,
                events: scheduleList.map(item => ({
                  title: item.reason + ' (' + item.timeSlot + ')',
                  date: item.eventDate,
                  extendedProps: {
                    timeSlot: item.timeSlot,
                    idx: item.idx
                  }
                })),
                eventClick: function(info) {
                  location.href = '/admin/schedule/view/' + info.event.extendedProps.idx;
                },
                // ✅ 시간 정렬 우선순위 적용
                eventOrder: function(a, b) {
                  const order = { "10시": 1, "12시": 2, "14시": 3, "16시": 4, "ALL": 99 };
                  return (order[a.extendedProps.timeSlot] || 999) - (order[b.extendedProps.timeSlot] || 999);
                }
              });

              calendar.render();
            } catch (e) {
              console.error("❌ JSON 파싱 실패:", e);
            }
        </script>
    </div>
</section>
</body>
</html>
